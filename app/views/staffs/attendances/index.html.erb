<h4>ID:<%= current_staff.id%>お名前:<%= current_staff.last_name%><%= current_staff.first_name%></h4>
  <div class="container">
    <div class="row">
      <div class="col-4 text-left">
        <%= link_to "< 前月",staffs_attendances_path(date: @one_month.first.last_month), class: "btn btn-outline-dark"%>
      </div>
      <div class="col-4 text-center">
        <h2><%= @one_month.first.strftime "%Y年%m月"%></h2>
      </div>
      <div class="col-4 text-right">
        <%= link_to "来月 >",staffs_attendances_path(date: @one_month.first.next_month), class: "btn btn-outline-dark" %>
      </div>
    <table class="table">
      <thead>
        <tr>
          <th>勤務日</th>
          <th>出勤</th>
          <th>休憩入</th>
          <th>休憩出</th>
          <th>退勤</th>
          <th>労働時間</th>
          <th>休憩時間</th>
          <th>実労働時間</th>
        </tr>
      </thead>
      <tbody>
      <% total_work_count = 0 %>
      <% total_work_b_hour = 0%>
      <% total_work_b_rest = 0%>
      <% total_work_t_hour = 0%>
      <% total_work_t_rest = 0%>
      <% total_break_hour = 0%>
      <% total_break_rest = 0%>
      <% @attendances.each do |attendance| %>
        <tr>
        <td>
          <%= attendance.worked_on %>
          <%= tag.span attendance.id, class: "ml-3" %>
        </td>
        <td><%= attendance.started_at&.strftime("%H時%H分%S秒") %></td>
        <td><%= attendance.break_started_at&.strftime("%H時%H分%S秒") %></td>
        <td><%= attendance.break_finished_at&.strftime("%H時%H分%S秒") %></td>
        <td><%= attendance.finished_at&.strftime("%H時%H分%S秒") %></td>
        <td>
          <% if attendance.started_at && attendance.finished_at %>
            <% min = (attendance.finished_at - attendance.started_at) / 60  %>
            <% hour = min / 60%>
            <% rest = min % 60%>
            <%= "#{hour.to_i}時間#{sprintf("%02d",rest.to_i)}分"%>
            <% total_work_b_hour += hour%>
            <% total_work_b_rest += rest%>
          <% end %>
          <% if attendance.started_at %>
            <% total_work_count += 1 %>
          <% end %>
        </td>
        <td>
          <% if attendance.break_started_at && attendance.break_finished_at %>
            <% b_min = (attendance.break_finished_at - attendance.break_started_at) / 60  %>
            <% b_hour = b_min / 60%>
            <% b_rest = b_min % 60%>
            <%= "#{b_hour.to_i}時間#{sprintf("%02d",b_rest.to_i)}分"%>
            <% total_break_hour += b_hour%>
            <% total_break_rest += b_rest%>
          <% end %>
        </td>
        <td>
          <% if attendance.started_at && attendance.finished_at %>
            <% if attendance.break_started_at && attendance.break_finished_at %>
              <% min = (attendance.finished_at - attendance.started_at) / 60  %>
              <% hour = min / 60%>
              <% rest = min % 60%>
              <% b_min = (attendance.break_finished_at - attendance.break_started_at) / 60  %>
              <% b_hour = b_min / 60%>
              <% b_rest = b_min % 60%>
              <% t_hour = hour - b_hour%>
              <% t_rest = rest - b_rest%>
              <%= "#{t_hour.to_i}時間#{sprintf("%02d",t_rest.to_i)}分"%>
              <% total_work_t_hour += t_hour%>
              <% total_work_t_rest += t_rest%>
            <% end %>
          <% end %>
        </td>
        </tr>
      <% end %>
      <tbody>
      <tfoot>
          <th>出勤回数</th>
          <th>合計勤務時間</th>
          <th>合計実勤務時間</th>
          <th>合計休憩時間</th>
          <th>給与</th>
        <tr>
          <td>
            <%= total_work_count %>
          </td>
          <td>
            <%= "#{total_work_b_hour.to_i}時間#{sprintf("%02d",total_work_b_rest.to_i)}分" %>
          </td>
          <td>
            <%= "#{total_work_t_hour.to_i}時間#{sprintf("%02d",total_work_t_rest.to_i)}分" %>
          </td>
          <td>
            <%= "#{total_break_hour.to_i}時間#{sprintf("%02d",total_break_rest.to_i)}分" %>
          </td>
        </tr>
      </tfoot>
    </table>
    </div>
  </div>
